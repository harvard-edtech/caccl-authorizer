<%
// TODO: pull course terms
console.log(courses);
// Pre-process courses into terms
const terms = {}; // Name to [] list of courses

courses.forEach((course) => {
  // Link
  course.link = `${launchPath}?course=${course.id}&next=${nextPath}`;
  // Privileges
  let isTeacher;
  let isTA;
  (course.enrollments || []).forEach((enrollment) => {
    if (enrollment.type === 'teacher') {
      isTeacher = true;
    }
    if (enrollment.type === 'ta') {
      isTA = true;
    }
  });
  let privileges;
  if (isTeacher) {
    privileges = 'teacher';
  } else if (isTA) {
    privileges = 'teaching assistant';
  }
  course.privileges = privileges;
  // Term
  if (!terms[course.term.name]) {
    terms[course.term.name] = [];
  }
  terms[course.term.name].push(course);
});

const termsList = [];
Object.keys(terms).forEach((term) => {
  termsList.push({
    name: term,
    courses: terms[term],
  });
});
termsList.sort();
%>

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>Choose Course</title>

  <!-- Inline styles for simplicity -->
  <link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet">
  <style type="text/css">
    body {
      background-color: #313c45;
      text-align: center;
      font-family: 'Lato', sans-serif;
    }

    .course-button {
      background-color: #3b8edc;
      color: white;
      font-weight: bold;
      border-radius: 5px;
      padding-left: 15px;
      padding-right: 15px;
      padding-top: 20px;
      padding-bottom: 20px;
      display: block;
      margin-bottom: 10px;
      text-decoration: none;
    }

    .course-button:hover {
      background-color: #48a8f0;
    }

    .container {
      margin-left: 30px;
      margin-right: 30px;
      margin-top: 10px;
      max-width: 850px;
      width: 100%;
      background-color: #37444e;
      color: black;
      border-radius: 5px;
      -webkit-box-shadow: 1px 1px 5px 0px rgba(0,0,0,0.75);
      -moz-box-shadow: 1px 1px 5px 0px rgba(0,0,0,0.75);
      box-shadow: 1px 1px 5px 0px rgba(0,0,0,0.75);
      display: inline-block;
      text-align: left;
    }

    .header {
      border-bottom: 1px solid black;
      padding-left: 15px;
      padding-right: 15px;
      padding-top: 20px;
      padding-bottom: 20px;
      background-color: #37444e;
      color: white;
      border-radius: 5px 5px 0 0;
    }

    .title {
      font-size: 1.5em;
      font-weight: bold;
    }

    .subtitle {
      font-size: 1.2em;
      color: #ccc;
    }

    .content {
      background-color: white;
      border-radius: 0 0 5px 5px;

      padding-left: 15px;
      padding-right: 15px;
      padding-top: 10px;
      padding-bottom: 10px;
    }

    .term-title {
      font-size: 1.2em;
      text-align: center;
      margin-bottom: 10px;
    }
    .course-title {
      font-size: 1.2em;
    }

    .course-role {
      font-size: 1em;
      color: #ddd;
    }
  </style>

</head>

<body>

  <div class="container">
    <div class="header">
      <div class="title">Choose Course</div>
      <div class="subtitle">Which course do you want to launch this app from?</div>
    </div>
    <div class="content">
      <% if (terms.length === 0) { %>
        <div class="subtitle">
          Oops! You aren't enrolled in or an instructor of any courses.
        </div>
      <% } %>

      <% termsList.forEach((term) => { %>
        <div class="term-title">
          <%= term.name %>
        </div>
        <% term.courses.forEach((course) => { %>
          <a class="course-button" href="<%= course.link %>" title="Launch from course: <%= course.name %>">
            <div class="course-title">
              <%= course.name %>
            </div>
            <% if (course.privileges) { %>
              <div class="course-role">
                You have <em><%= course.privileges %></em> privileges.
              </div>
            <% } %>
          </a>
        <% }); %>
      <% }); %>
    </div>
  </div>

</body>
